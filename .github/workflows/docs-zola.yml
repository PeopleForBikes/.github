name: docs

on:
  workflow_call:
    inputs:
      build-dir:
        description:
          "The path from the root of the repo where we should run the zola build
          command"
        default: "."
        required: false
        type: string

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0
      - uses: extractions/setup-just@e33e0265a09d6d736e2ee1e0eb685ef1de4669ff # v3.0.0
      - name: lint sass
        run: just lint-sass
      - name: lint markdown
        run: just lint-md
      - name: Check spelling
        run: just lint-spelling

  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0
      - name: build
        uses: shalzz/zola-deploy-action@90cd842959b82e0c012601be18ae249d6cdb1669 # v0.21.0
        env:
          BUILD_DIR: ${{ inputs.build-dir }}
          BUILD_ONLY: true

  deploy:
    runs-on: ubuntu-latest
    needs:
      - lint
      - build
    if: github.ref == 'refs/heads/main'
    steps:
      - uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0
      - name: build
        uses: shalzz/zola-deploy-action@90cd842959b82e0c012601be18ae249d6cdb1669 # v0.21.0
        env:
          BUILD_DIR: ${{ inputs.build-dir }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
